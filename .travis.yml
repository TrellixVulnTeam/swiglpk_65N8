language: python
python: 3.5
sudo: required
dist: trusty
services: docker
sudo: required

env:
  global:
    - secure: "meAZ7j4RADKM6Nm9upYOt+klXWDieipJQ4CWrKRYEZzjwq8HUq1+Qb41gJhUThYbbXQdssKVAv8CSS5Ii3Ka+t/y80qGjt6Yp0ZvyJyswJiv4Il0stNe8mNvD3DA95OilwCsx3mxs5WFiCVFmaBe/fpHr4N9jvHIAiLIj3/ytdQ="
    - secure: "CGG4wmppNXaAD/GWIvhDhq+5F1jp+ecFFv99/RM/vENewb/V8O1Cg0fJ8hM/KAgNbEgAYJVgbShRPMN5UlT7UUgGPg66lVtWItvBMg/2uJaepzA1Mn7Ceuu7vv7/zbzFRZHFdjvbIzGU8kI4rJB++NfZFFezOaC0FhMuOgwcw0g="
    - PLAT=x86_64
    - UNICODE_WIDTH=32
    - NP_BUILD_DEP="numpy==1.7.1"
    - NP_TEST_DEP="numpy==1.7.1"

matrix:
  exclude:
      - python: 3.5
  include:
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=2.7
        - PLAT=i686
        - UNICODE_WIDTH=16
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.4
        - PLAT=i686
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - TOXENV=py35
    - os: linux
      env:
        - MB_PYTHON_VERSION=3.5
        - PLAT=i686
    - os: osx
      language: objective-c
      env:
        - MB_PYTHON_VERSION=2.7
    - os: osx
      language: objective-c
      env:
        - MB_PYTHON_VERSION=3.4
    - os: osx
      language: objective-c
      env:
        - MB_PYTHON_VERSION=3.5

before_install:
  - (git clone https://github.com/matthew-brett/multibuild.git && cd multibuild && git checkout d7ba4ae)
  - TEST_DEPENDS="nose"
  - source multibuild/common_utils.sh
  - source multibuild/travis_steps.sh
  - before_install

install:
  # why no tox? tox runs in its own virtual env it seems that `which glpsol` doesn't work there 
  - build_wheel . $PLAT

script:
  - install_run $PLAT

deploy:
  provider: script
  skip_cleanup: true
  script: scripts/deploy.sh
  on:
    branch: feature/auto-wheel
#    tags: true
